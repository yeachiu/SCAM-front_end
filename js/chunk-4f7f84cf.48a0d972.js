(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4f7f84cf"],{3846:function(e,t,a){a("9e1e")&&"g"!=/./g.flags&&a("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:a("0bfb")})},"6b54":function(e,t,a){"use strict";a("3846");var n=a("cb7c"),r=a("0bfb"),o=a("9e1e"),s="toString",i=/./[s],l=function(e){a("2aba")(RegExp.prototype,s,e,!0)};a("79e5")(function(){return"/a/b"!=i.call({source:"a",flags:"b"})})?l(function(){var e=n(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?r.call(e):void 0)}):i.name!=s&&l(function(){return i.call(this)})},f638:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Card",[a("p",{staticClass:"card-title",attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"home"}}),a("span",[e._v("角色管理")])],1),a("div",[[a("Row",[a("Col",{attrs:{span:"15"}},[a("Button",{attrs:{type:"info"},on:{click:function(t){e.openAddOrUpModal(null)}}},[a("Icon",{attrs:{type:"md-add"}}),e._v(" 添加角色")],1),a("Button",{attrs:{disabled:e.setting.loading,type:"success"},on:{click:e.getData}},[a("Icon",{attrs:{type:"md-refresh"}}),e._v(" 刷新数据")],1),a("Button",{attrs:{type:"primary"},on:{click:function(t){e.exportData(1)}}},[a("Icon",{attrs:{type:"ios-download-outline"}}),e._v(" 导出表格")],1)],1),a("Col",{attrs:{span:"9"}},[a("Input",{staticClass:"margin-bottom-10",attrs:{placeholder:"请输入您想要搜索的内容..."},model:{value:e.search.value,callback:function(t){e.$set(e.search,"value",t)},expression:"search.value"}},[a("Button",{attrs:{slot:"append",icon:"ios-search"},slot:"append"})],1)],1)],1),a("Table",{ref:"table",staticClass:"margin-bottom-10",attrs:{columns:e.columns,loading:e.setting.loading,border:e.setting.showBorder,data:e.data.records}}),a("Page",{staticClass:"tr",attrs:{total:e.data.total,current:e.data.current,"page-size":e.data.size,"show-elevator":"","show-sizer":""},on:{"on-change":e.pageChange,"update:current":function(t){e.$set(e.data,"current",t)},"on-page-size-change":e.pageSizeChange}})]],2)]),e.addRoleModal?a("AddRole",{attrs:{"all-resource":e.allResource},on:{cancel:e.onAddRoleModalCancel}}):e._e(),e.updateRoleModal?a("UpdateRole",{attrs:{"all-resource":e.allResource,"update-object":e.updateObject},on:{cancel:e.onUpdateRoleModalCancel}}):e._e(),a("Modal",{attrs:{width:"360"},model:{value:e.removeModal,callback:function(t){e.removeModal=t},expression:"removeModal"}},[a("p",{staticStyle:{color:"#f60","text-align":"center"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"information-circled"}}),a("span",[e._v("提示")])],1),a("div",{staticStyle:{"text-align":"center"}},[a("p",[e._v("此操作为不可逆操作，是否确认删除？")])]),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"error",size:"large",long:"",loading:e.setting.loading},on:{click:e.remove}},[e._v("确认删除")])],1)])],1)},r=[],o=a("7618"),s=(a("7f7f"),a("ac6a"),a("96cf"),a("3b8d")),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Modal",{attrs:{title:"角色添加",loading:e.loading,"mask-closable":!1,width:800,closable:!1},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[a("Form",{ref:"addrole",attrs:{model:e.formItem,"label-width":90,rules:e.ruleValidate}},[a("FormItem",{attrs:{label:"角色名称：",prop:"name"}},[a("Input",{attrs:{placeholder:"角色名称"},model:{value:e.formItem.name,callback:function(t){e.$set(e.formItem,"name",t)},expression:"formItem.name"}})],1)],1),a("Form",{attrs:{"label-width":70}},[a("FormItem",{attrs:{label:"权限集：",prop:"permissions"}},[a("Tree",{ref:"tree",attrs:{data:e.formItem.permissions,"show-checkbox":""}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default",disabled:e.loading},on:{click:function(t){e.cancel(!1)}}},[e._v("取消")]),a("Button",{attrs:{type:"primary",loading:e.loading},on:{click:e.ok}},[e._v("确定")])],1)],1)],1)},l=[],c=a("f499"),u=a.n(c),d=a("d689"),p={data:function(){return{formItem:{name:"",permissions:[]},showModal:!0,loading:!1,ruleValidate:{name:[{required:!0,message:"角色名称不能为空"}]}}},props:{allResource:{type:Array}},created:function(){this.getAllResource()},methods:{cancel:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$emit("cancel",e)},ok:function(){var e=this,t=this.$refs.tree.getCheckedNodes();this.$refs.addrole.validate(function(a){if(a)if(t.length<1)e.$Notice.destroy(),e.$Notice.warning({title:"请至少选择一个权限资源",duration:2});else{var n={name:e.formItem.name,resources:t};e.add(n)}})},add:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,Object(d["b"])("/system/role/add",t);case 4:e.sent,this.$Message.success("角色 "+t.name+" 添加成功"),this.cancel(!0),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),this.$throw(e.t0);case 12:this.loading=!1;case 13:case"end":return e.stop()}},e,this,[[1,9]])}));function t(t){return e.apply(this,arguments)}return t}(),getAllResource:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=JSON.parse(u()(this.allResource)),this.dealPostData(t),this.formItem.permissions=t;case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),dealPostData:function(e){var t=this;e.forEach(function(e){e.title=e.name,null!=e.children&&t.dealPostData(e.children)})}}},h=p,m=a("2877"),f=Object(m["a"])(h,i,l,!1,null,null,null);f.options.__file="add.vue";var g=f.exports,v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Modal",{attrs:{title:"更新角色",loading:e.loading,"mask-closable":!1,width:800,closable:!1},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[a("Form",{ref:"updateRole",attrs:{model:e.formItem,"label-width":90,rules:e.ruleValidate}},[a("FormItem",{attrs:{label:"角色名称：",prop:"name"}},[a("Input",{attrs:{placeholder:"角色名称"},model:{value:e.formItem.name,callback:function(t){e.$set(e.formItem,"name",t)},expression:"formItem.name"}})],1)],1),a("Form",{attrs:{"label-width":70}},[a("FormItem",{attrs:{label:"权限集：",prop:"permissions"}},[a("Tree",{ref:"tree",attrs:{data:e.formItem.permissions,"show-checkbox":""}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default",disabled:e.loading},on:{click:function(t){e.cancel(!1)}}},[e._v("取消")]),a("Button",{attrs:{type:"primary",loading:e.loading},on:{click:e.ok}},[e._v("确定")])],1)],1)],1)},b=[],w=(a("6b54"),{data:function(){return{formItem:{name:"",permissions:[]},showModal:!0,loading:!1,ruleValidate:{name:[{required:!0,message:"角色名称不能为空"}]}}},props:{updateObject:{type:Object,default:null},allResource:{type:Array}},created:function(){null!=this.updateObject&&(this.formItem.name=this.updateObject.name),this.getAllResource()},methods:{cancel:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$emit("cancel",e)},ok:function(){var e=this,t=this.$refs.tree.getCheckedNodes();this.$refs.updateRole.validate(function(a){if(a)if(t.length<1)e.$Notice.destroy(),e.$Notice.warning({title:"请至少选择一个权限资源",duration:2});else{var n={name:e.formItem.name,resources:t};e.update(n)}})},update:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,Object(d["b"])("/system/role/update/{id}",t,{id:this.updateObject.id});case 4:e.sent,this.$Message.success("角色 "+t.name+" 更新成功"),this.cancel(!0),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),this.$throw(e.t0);case 12:this.loading=!1;case 13:case"end":return e.stop()}},e,this,[[1,9]])}));function t(t){return e.apply(this,arguments)}return t}(),getAllResource:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=JSON.parse(u()(this.allResource)),this.dealPostData(t),this.formItem.permissions=t;case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),permissionSync:function(e){function t(t,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){null!=e&&e.length>0&&e.forEach(function(a){a.id==t.id&&(t.checked=!0),null!=a.children&&a.children.length>0&&permissionSync(e,t)})}),dealPostData:function(e){var t=this;e.forEach(function(e){e.title=e.name,t.permissionSync(t.updateObject.resources,e),null!=e.children&&t.dealPostData(e.children)})}}}),y=w,R=Object(m["a"])(y,v,b,!1,null,null,null);R.options.__file="update.vue";var k=R.exports,x={data:function(){var e=this;return{addRoleModal:!1,updateRoleModal:!1,updateObject:null,removeModal:!1,setting:{loading:!0,showBorder:!0},search:{type:"name",value:""},columns:[{title:"ID",key:"id",sortable:!0},{title:"角色名",key:"name",sortable:!0},{title:"操作",key:"action",width:260,align:"center",render:function(t,a){return t("div",[t("Button",{props:{type:"success",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.showAllResource(a.row)}}},"查看权限集"),t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.openAddOrUpModal(a.row)}}},"修改信息"),t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.removeObject={obj:a.row,index:a.index},e.removeModal=!0}}},"删除")])}}],data:{},dataFilter:{page:1,pageSize:10},removeObject:null,allResource:null}},components:{AddRole:g,UpdateRole:k},created:function(){this.getData()},methods:{pageChange:function(e){this.dataFilter.page=e,this.getData()},pageSizeChange:function(e){this.dataFilter.pageSize=e,this.getData()},getAllResource:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(d["b"])("/system/resource/list");case 3:t=e.sent,this.allResource=t.data,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.$throw(e.t0);case 10:case"end":return e.stop()}},e,this,[[0,7]])}));function t(){return e.apply(this,arguments)}return t}(),remove:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.removeModal=!1,null!=this.removeObject){e.next=4;break}return this.$Message.warning("删除对象为空，无法继续执行！"),e.abrupt("return",!1);case 4:return this.setting.loading=!0,e.prev=5,e.next=8,Object(d["b"])("/system/role/remove/{rid}",null,{rid:this.removeObject.obj.id});case 8:e.sent,this.$Message.success("删除成功"),this.data.records.splice(this.removeObject.index,1),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](5),this.$throw(e.t0);case 16:this.setting.loading=!1;case 17:case"end":return e.stop()}},e,this,[[5,13]])}));function t(){return e.apply(this,arguments)}return t}(),getData:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.setting.loading=!0,e.prev=1,e.next=4,Object(d["b"])("/system/role/list",{page:this.dataFilter.page,pageSize:this.dataFilter.pageSize});case 4:t=e.sent,this.data=t.data,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](1),this.$throw(e.t0);case 11:this.setting.loading=!1;case 12:case"end":return e.stop()}},e,this,[[1,8]])}));function t(){return e.apply(this,arguments)}return t}(),openAddOrUpModal:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a,n=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a=n.length>1&&void 0!==n[1]?n[1]:"update",null!==this.allResource){e.next=4;break}return e.next=4,this.getAllResource();case 4:null===t?this.addRoleModal=!0:"update"===a&&(this.updateObject=t,this.updateRoleModal=!0);case 5:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),onAddRoleModalCancel:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.addRoleModal=!1,e&&this.getData()},onUpdateRoleModalCancel:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.updateRoleModal=!1,e&&this.getData()},dealPostData:function(e,t,a){var n=this;null!=e&&e.forEach(function(e){var r=a("Tag",{props:{color:"green",type:"dot"}},e.name);t.push(r),null!=e.children&&n.dealPostData(e.children,t,a)})},showAllResource:function(e){var t=this,a=e.resources;null!=a&&"object"==Object(o["a"])(a)&&a.length>0?this.$Modal.info({title:e.name+" - 权限集",width:"40%",render:function(e){var n=[];return a.forEach(function(a){var r=e("Tag",{props:{color:""==a.color?"green":a.color,type:"dot"}},a.name);n.push(r),t.dealPostData(a.children,n,e)}),e("div",{style:{padding:"20px 0 10px 0"}},n)}}):(this.$Notice.destroy(),this.$Notice.info({title:"该角色暂无权限信息",duration:3}))},exportData:function(e){var t=this;1===e&&this.$refs.table.exportCsv({filename:"权限数据-"+(new Date).getTime(),columns:this.columns.filter(function(e,a){return a>1&&a<t.columns.length-1}),data:this.data})}}},M=x,O=Object(m["a"])(M,n,r,!1,null,null,null);O.options.__file="index.vue";t["default"]=O.exports}}]);